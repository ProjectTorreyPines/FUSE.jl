<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Contributing · FUSE</title><meta name="title" content="Contributing · FUSE"/><meta property="og:title" content="Contributing · FUSE"/><meta property="twitter:title" content="Contributing · FUSE"/><meta name="description" content="Documentation for FUSE."/><meta property="og:description" content="Documentation for FUSE."/><meta property="twitter:description" content="Documentation for FUSE."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img class="docs-light-only" src="assets/logo.svg" alt="FUSE logo"/><img class="docs-dark-only" src="assets/logo-dark.svg" alt="FUSE logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Main</a></li><li><span class="tocitem">Learn</span><ul><li><a class="tocitem" href="tutorial.html">Tutorial</a></li><li><a class="tocitem" href="examples.html">Examples</a></li><li><a class="tocitem" href="pubs.html">Publications</a></li></ul></li><li><a class="tocitem" href="cases.html">Use Cases</a></li><li><span class="tocitem">Actors</span><ul><li><a class="tocitem" href="actors.html">List of actors</a></li><li><a class="tocitem" href="act.html">act parameters</a></li></ul></li><li><span class="tocitem">Initialization</span><ul><li><a class="tocitem" href="inits.html">Init routines</a></li><li><a class="tocitem" href="ini.html">ini parameters</a></li></ul></li><li><a class="tocitem" href="dd.html">Data Structure</a></li><li><span class="tocitem">Development</span><ul><li><a class="tocitem" href="deps.html">Ecosystem</a></li><li class="is-active"><a class="tocitem" href="develop.html">Contributing</a><ul class="internal"><li><a class="tocitem" href="#Add/modify-entries-in-dd"><span>Add/modify entries in <code>dd</code></span></a></li><li><a class="tocitem" href="#Write-IMAS-physics-functions"><span>Write IMAS physics functions</span></a></li><li><a class="tocitem" href="#Add/modify-entries-in-ini-and-act"><span>Add/modify entries in <code>ini</code> and <code>act</code></span></a></li><li><a class="tocitem" href="#Write-a-new-actor"><span>Write a new actor</span></a></li><li><a class="tocitem" href="#Add-a-new-material"><span>Add a new material</span></a></li><li><a class="tocitem" href="#Profiling-and-writing-fast-Julia-code"><span>Profiling and writing fast Julia code</span></a></li><li><a class="tocitem" href="#Build-the-documentation"><span>Build the documentation</span></a></li><li><a class="tocitem" href="#Add/modify-examples"><span>Add/modify examples</span></a></li><li><a class="tocitem" href="#Use-Revise.jl"><span>Use Revise.jl</span></a></li><li><a class="tocitem" href="#Develop-in-VScode"><span>Develop in VScode</span></a></li><li><a class="tocitem" href="#Track-Julia-precompilation"><span>Track Julia precompilation</span></a></li><li><a class="tocitem" href="#Run-Julia-within-a-Python-environment"><span>Run Julia within a Python environment</span></a></li></ul></li></ul></li><li><span class="tocitem">Install</span><ul><li><a class="tocitem" href="install.html">Install FUSE</a></li><li><a class="tocitem" href="install_saga.html">on SAGA</a></li><li><a class="tocitem" href="install_omega.html">on OMEGA</a></li></ul></li><li><span class="tocitem">License</span><ul><li><a class="tocitem" href="license.html">License</a></li><li><a class="tocitem" href="notice.html">Notice</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Development</a></li><li class="is-active"><a href="develop.html">Contributing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="develop.html">Contributing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ProjectTorreyPines/FUSE.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ProjectTorreyPines/FUSE.jl/blob/master/docs/src/develop.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Contributing"><a class="docs-heading-anchor" href="#Contributing">Contributing</a><a id="Contributing-1"></a><a class="docs-heading-anchor-permalink" href="#Contributing" title="Permalink"></a></h1><p>FUSE is a collaborative project that welcomes community contributions!</p><p>The <code>master</code> branch of ProjectTorreyPines repositories is write-protected. This means that even with write permissions to the repository, you&#39;ll not be able to push to <code>master</code> directly. Instead, we handle updates – be it new features or bug fixes – through branches and Pull Requests (PRs).</p><p>A crucial part of our PR process is <strong>code review</strong>. It is where your peers get to weigh in and ensure everything is up to standard before merging. When you create a PR, think about who on the team has the right expertise for the code you&#39;re working on, and assign them as reviewers. Their insights will not only help in maintaining code quality but also in catching any potential issues early. It is all about teamwork and making sure our code is the best it can be!</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>When working on a new feature that involves changes to FUSE and other ProjectTorreyPines repositories, you&#39;ll want to use the same branch name across these repositories. For example, if you&#39;re working on a branch named <code>my_new_feature</code> in both FUSE and IMAS, regression testing will be performed using the <code>my_new_feature</code> branches for FUSE and IMAS, along with the <code>master</code> branch of the other <code>ProjectTorreyPines</code> repositories.</p></div></div><h2 id="Add/modify-entries-in-dd"><a class="docs-heading-anchor" href="#Add/modify-entries-in-dd">Add/modify entries in <code>dd</code></a><a id="Add/modify-entries-in-dd-1"></a><a class="docs-heading-anchor-permalink" href="#Add/modify-entries-in-dd" title="Permalink"></a></h2><p>The <code>dd</code> data structure is defined under the <a href="https://github.com/ProjectTorreyPines/IMASdd.jl">IMASdd.jl</a> package. See the documentation there to how add/modify entries in <code>dd</code>.</p><h2 id="Write-IMAS-physics-functions"><a class="docs-heading-anchor" href="#Write-IMAS-physics-functions">Write IMAS physics functions</a><a id="Write-IMAS-physics-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Write-IMAS-physics-functions" title="Permalink"></a></h2><p>IMAS physics and engineering functions are structured in <a href="https://github.com/ProjectTorreyPines/IMAS.jl">IMAS.jl</a> under <code>IMAS/src/physics</code>. These functions use or modify the datastructure (dd) in some way and are used to calculate certain quantities or fill the data structure.</p><p>Let&#39;s say we want to create a function that calculates the DT fusion and then fill <code>core_sources</code> with the alpha heating from that source. Here is an example of writing it in a good way:</p><pre><code class="language-julia hljs">function DT_fusion_source!(dd::IMAS.dd)
    return DT_fusion_source!(dd.core_sources, dd.core_profiles)
end

&quot;&quot;&quot;
    DT_fusion_source!(cs::IMAS.core_sources, cp::IMAS.core_profiles)

Calculates DT fusion heating with an estimation of the alpha slowing down to the ions and electrons, modifies dd.core_sources
&quot;&quot;&quot;
function DT_fusion_source!(cs::IMAS.core_sources, cp::IMAS.core_profiles)
    # // actual implementation here //
end</code></pre><div class="admonition is-category-convention"><header class="admonition-header">Convention</header><div class="admonition-body"><p>The documentation string is added to the specialized function <code>DT_fusion_source!(cs::IMAS.core_sources, cp::IMAS.core_profiles)</code> and the dispatch function <code>DT_fusion_source!(dd::IMAS.dd)</code> is added on top of the function</p></div></div><h2 id="Add/modify-entries-in-ini-and-act"><a class="docs-heading-anchor" href="#Add/modify-entries-in-ini-and-act">Add/modify entries in <code>ini</code> and <code>act</code></a><a id="Add/modify-entries-in-ini-and-act-1"></a><a class="docs-heading-anchor-permalink" href="#Add/modify-entries-in-ini-and-act" title="Permalink"></a></h2><p>The functinoality of the <code>ini</code> and <code>act</code> parameters is implemented in the <a href="https://github.com/ProjectTorreyPines/SimulationParameters.jl">SimulationParameters.jl</a> package.</p><ul><li>The <code>ini</code> parameters are all defined in the <code>FUSE/src/parameters_init.jl</code> file. Add/edit entries there.</li><li>The <code>act</code> parameters of each actor are defined where that actor is defined. Add/edit entries there.</li></ul><h2 id="Write-a-new-actor"><a class="docs-heading-anchor" href="#Write-a-new-actor">Write a new actor</a><a id="Write-a-new-actor-1"></a><a class="docs-heading-anchor-permalink" href="#Write-a-new-actor" title="Permalink"></a></h2><p>Actors are grouped into two main abstract types:</p><pre><code class="language-julia hljs">abstract type CompoundAbstractActor{D,P} &lt;: AbstractActor{D,P} end
abstract type SingleAbstractActor{D,P} &lt;: AbstractActor{D,P} end</code></pre><p>CompoundAbstractActors are for actors that compound multiple actors underneath and are initalized with <code>ActorNAME(dd, par, act)</code> while SingleAbstractActors are single actors initalized with <code>ActorNAME(dd, par)</code></p><p>The definition of each FUSE actor follows a well defined pattern. <strong>DO NOT</strong> deviate from this pattern. This is important to ensure modularity and compostability of the actors.</p><pre><code class="language-julia hljs"># Definition of the `act` parameters relevant to the actor
Base.@kwdef mutable struct FUSEparameters__ActorNAME{T&lt;:Real} &lt;: ParametersActor{T}
    _parent::WeakRef = WeakRef(nothing)
    _name::Symbol = :not_set
    length::Entry{T} = Entry(T, &quot;m&quot;, &quot;Some decription&quot;) # it&#39;s ok not to have a default, it forces users to think about what a parameter should be
    verbose::Entry{Bool} = Entry(Bool, &quot;&quot;, &quot;Some other decription&quot;; default=true)
    switch::Switch{Symbol} = Switch(Symbol, [:option_a, :option_b], &quot;&quot;, &quot;user can only select one of these&quot;; default=:option_a)
end

# Defintion of the actor structure
# NOTE: To be valid all actors must have `dd::IMAS.dd` and `par::FUSEparameters__ActorNAME`
mutable struct ActorNAME &lt;: ???AbstractActor
    dd::IMAS.dd
    par::FUSEparameters__ActorNAME  # Actors must carry with them the parameters they are run with
    something_else::??? # Some actors may want to carry something else with them
    # Inner constructor for the actor starting from `dd` and `par` (we generally refer to `par` as `act.ActorNAME`)
    # NOTE: Computation should not happen here since in workflows it is normal to instantiate
    #       an actor once `ActorNAME(dd, act.ActorNAME)` and then call `finalize(step(actor))` several times as needed.
    function ActorNAME(dd::IMAS.dd, par::FUSEparameters__ActorNAME; kw...)
        logging_actor_init(ActorNAME)
        par = par(kw...)
        return new(dd, par, something_else)
    end
end

# Constructor with with `dd` and `act` as arguments will actually run the actor!
# That&#39;s how users will mostly run this actor.
# This does not change, and it&#39;s always the same for all actors
&quot;&quot;&quot;
    ActorNAME(dd::IMAS.dd, act::ParametersAllActors; kw...)

What does this actor do...
&quot;&quot;&quot;
function ActorNAME(dd::IMAS.dd, act::ParametersAllActors; kw...)
    par = act.ActorNAME(kw...) # this makes a local copy of `act.ActorNAME` and overrides it with keywords that the user may have passed
    actor = ActorNAME(dd, par) # instantiate the actor (see function below)
    step(actor)                # run the actor
    finalize(actor)            # finalize
    return actor
end

# define `_step` function for this actor (this is where most of the action occurs)
# note the leading underscore (use the `_step()` and not `step()` for the FUSE logging system to work with your actor)
# `_step()` should not take any argument besides the actor itself
function _step(actor::ActorNAME)
    ...
    return actor # _step() should always return the actor
end

# define `_finalize` function for this actor (this is where typically data gets written in `dd` if that does happen already at the `step`)
# note the leading underscore (use the `_finalize()` and not `finalize()` for the FUSE logging system to work with your actor)
# `_finalize()` should not take any argument besides the actor itself
function _finalize(actor::ActorNAME)
    ...
    return actor # _finalize() should always return the actor
end</code></pre><h2 id="Add-a-new-material"><a class="docs-heading-anchor" href="#Add-a-new-material">Add a new material</a><a id="Add-a-new-material-1"></a><a class="docs-heading-anchor-permalink" href="#Add-a-new-material" title="Permalink"></a></h2><p>Material properties for supported fusion-relevant materials are stored in the <a href="https://github.com/ProjectTorreyPines/FusionMaterials.jl">FusionMaterials.jl</a> package, specifically in <code>FusionMaterials/src/materials.jl</code>. Properties of each material can be accessed by calling the <code>Material</code> function with the material name as a symbol passed as the function argument. </p><p>To add a new material whose properties can be accessed in FUSE, first add a function to <code>materials.jl</code> called Material with the function argument being your material&#39;s name. In the body of the function, assign the material&#39;s name (as a string, all lowercase, and with any spaces filled by underscores), type (as a list containing each possible IMAS BuildLayerType the material could be assigned to), density (in <code>kg/m^3</code>) and unit cost (in US dollars per kilogram). Include a comment providing a link to the source from which the unit cost was taken. </p><p>Below is an example of a complete Material function for a non-superconductor material (more about superconductor materials below): </p><pre><code class="language-julia hljs">function Material(::Type{Val{:graphite}};)
	mat = Material()
	mat.name = &quot;graphite&quot; # string with no spaces
	mat.type = [IMAS._wall_] # list of allowable layer types for this material
	mat.density = 1.7e3 # in kg/m^3
	mat.unit_cost = 1.3 # in US$/kg, include source as a comment # source: https://businessanalytiq.com/procurementanalytics/index/graphite-price-index/
	return mat
end</code></pre><p>If the material is a superconductor that is meant to be assigned to magnet-type layers, additional characteristics need to be defined. First, add the relevant critical current density scaling for the chosen superconductor material as a function in <code>FusionMaterials/src/jcrit.jl</code>. Then, assign the technology parameters for the material (temperature, steel fraction, void fraction, and ratio of superconductor to copper) to their respective fields in coil<em>tech within the coil</em>technology function in <code>FUSE/src/technology.jl</code>. Finally, call the critical current density scaling function within the newly written Material function in <code>materials.jl</code> and assign the output critical current density and critical magnetic field to the material object. The coil_tech object should be passed as an argument to the Material function, along with the external B field, and used to calculate the critical current density and critical magnetic field. </p><p>Below is an example of a complete superconductor Material function: </p><pre><code class="language-julia hljs">function Material(::Type{Val{:rebco}}; coil_tech::Union{Missing, IMAS.build__pf_active__technology, IMAS.build__oh__technology, IMAS.build__tf__technology} = missing, Bext::Union{Real, Missing} = missing)
	mat = Material()
	mat.name = &quot;rebco&quot;
	mat.type = [IMAS._tf_, IMAS._oh_]
	mat.density = 6.3
	mat.unit_cost = 7000

	if !ismissing(coil_tech)
		Jcrit_SC, Bext_Bcrit_ratio = ReBCO_Jcrit(Bext, coil_tech.thermal_strain + coil_tech.JxB_strain, coil_tech.temperature) # A/m^2
		fc = fraction_conductor(coil_tech)
		mat.critical_current_density = Jcrit_SC * fc
		mat.critical_magnetic_field = Bext / Bext_Bcrit_ratio
	end

	return mat
end</code></pre><p>The function <code>ReBCO_Jcrit</code> is the critical current density function for this material. </p><p>You can then access the parameters of your material by calling the function you&#39;ve created. For example, access the material&#39;s density anywhere in FUSE by calling: </p><pre><code class="language-julia hljs">my_mat_density = Material(:my_mat).density</code></pre><h2 id="Profiling-and-writing-fast-Julia-code"><a class="docs-heading-anchor" href="#Profiling-and-writing-fast-Julia-code">Profiling and writing fast Julia code</a><a id="Profiling-and-writing-fast-Julia-code-1"></a><a class="docs-heading-anchor-permalink" href="#Profiling-and-writing-fast-Julia-code" title="Permalink"></a></h2><p>First let&#39;s do some profiling to identify problemetic functions:</p><ol><li><p>Run FUSE from the VScode Julia REPL (<code>&lt;Command-Shift-p&gt;</code> and then <code>Julia: Start REPL</code>)</p><pre><code class="language-julia hljs">using FUSE
FUSE.logging(Logging.Info; actors=Logging.Info);
ini, act = FUSE.case_parameters(:FPP; version=:v1_demount, init_from=:scalars, STEP=true);
dd = IMAS.dd()
FUSE.init(dd, ini, act)
FUSE.ActorWholeFacility(dd, act); # call this once to precompile</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"></div></div><p>Alternatively one can create a <code>profile.jl</code> file in the <code>FUSE/playground</code> folder, write Julia code in that file, select the code to execute and run it with <code>&lt;Control-Return&gt;</code>.</p></li><li><p>Use <code>@time</code> to monitor execution time and allocations</p></li><li><p>For functions that return very quickly one can use <code>BenchmarkTooks.@benchmark</code></p></li><li><p>Graphical profiling of the execution time is a powerful way to understand where time is spent</p><pre><code class="language-julia hljs">@profview FUSE.ActorWholeFacility(dd, act);</code></pre><p>where <code>FUSE.ActorWholeFacility(dd, act);</code> can really be any function that we care about</p></li><li><p>Look at allocations</p><pre><code class="language-julia hljs">@profview_allocs FUSE.ActorWholeFacility(dd, act);</code></pre></li><li><p>We can decide how finely to comb for bottlenecks by setting <code>sample_rate</code> in <code>@profview</code> and <code>@profview_allocs</code>:</p><pre><code class="nohighlight hljs">@profview_allocs f(args...) [sample_rate=0.0001] [C=false]</code></pre></li></ol><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>To move forward we have to <a href="https://docs.julialang.org/en/v1/manual/performance-tips">understand how to write performant Julia code</a>.</p></div></div><p>Let&#39;s now investigate where the issue is with the function that we have identified. For this we have several tools at our disposal:</p><ul><li><p><a href="https://docs.julialang.org/en/v1/manual/performance-tips/#man-code-warntype"><code>@code_warntype</code></a>: static analyzer built-in with Julia</p><ul><li>only looks at types that are inferred at runtime</li><li>reports types only for the target function</li><li><code>@code_warntype function()</code></li></ul></li><li><p><a href="https://github.com/aviatesk/JET.jl">JET</a>: static analyzer integrated with VScode</p><ul><li>can detect different possible issues, including types inferred at runtime</li><li>JET goes deep into functions</li><li><code>JET.@report_opt function()</code> reports dynamic dispatch</li><li><code>JET.@report_call function()</code> reports type errors</li><li><code>JET.@report_call target_modules=(FUSE,IMAS,IMAS.IMASdd, ) FUSE.ActorNeutronics(dd,act);</code></li></ul></li><li><p><a href="https://github.com/JuliaDebug/Cthulhu.jl">Cthulhu</a>: interactive static analyzer</p><ul><li><code>Cthulhu.@descend function()</code></li></ul></li></ul><h2 id="Build-the-documentation"><a class="docs-heading-anchor" href="#Build-the-documentation">Build the documentation</a><a id="Build-the-documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Build-the-documentation" title="Permalink"></a></h2><ol><li><p>To build the documentation, in the <code>FUSE/docs</code> folder, start Julia then:</p><pre><code class="language-julia hljs">] activate .
include(&quot;make.jl&quot;)</code></pre><p>!!! tip Interactive documentation build     One can call <code>include(&quot;make.jl&quot;)</code> over and over within the same Julia session to avoid dealing with startup time.</p></li><li><p>Check page by opening <code>FUSE/docs/build/index.html</code> page in web-browser.</p></li><li><p>The online documentation is built after each commit to <code>master</code> via GitHub actions.</p></li></ol><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Documentation files (PDF, DOC, XLS, PPT, ...) can be committed and pushed to the <a href="https://github.com/ProjectTorreyPines/FUSE_extra_files">FUSE_extra_files</a> repository, and then linked directly from within the FUSE documentation, like this:</p><pre><code class="language-markdown hljs">[video recording of the first FUSE tutorial](https://github.com/ProjectTorreyPines/FUSE_extra_files/raw/master/FUSE_tutorial_1_6Jul22.mp4)</code></pre></div></div><h2 id="Add/modify-examples"><a class="docs-heading-anchor" href="#Add/modify-examples">Add/modify examples</a><a id="Add/modify-examples-1"></a><a class="docs-heading-anchor-permalink" href="#Add/modify-examples" title="Permalink"></a></h2><p>The <a href="https://github.com/ProjectTorreyPines/FuseExamples">FuseExamples repository</a> contains jupyter notebook that showcase some possible uses of FUSE.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>When committing changes to in a jupyter notebook, make sure that all the output cells are cleared! This is important to keep the size of the repository in check.</p></div></div><h2 id="Use-Revise.jl"><a class="docs-heading-anchor" href="#Use-Revise.jl">Use Revise.jl</a><a id="Use-Revise.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Use-Revise.jl" title="Permalink"></a></h2><p>Install <a href="https://github.com/timholy/Revise.jl">Revise.jl</a> to modify code and use the changes without restarting Julia. We recommend adding <code>import Revise</code> to your <code>~/.julia/config/startup.jl</code> to automatically import Revise at the beginning of all Julia sessions. This can be done by running:</p><pre><code class="language-bash hljs">fusebot install_revise</code></pre><h2 id="Develop-in-VScode"><a class="docs-heading-anchor" href="#Develop-in-VScode">Develop in VScode</a><a id="Develop-in-VScode-1"></a><a class="docs-heading-anchor-permalink" href="#Develop-in-VScode" title="Permalink"></a></h2><p><a href="https://code.visualstudio.com">VScode</a> is an excellent development environment for Julia.</p><p>FUSE uses the following VScode settings for formatting the Julia code:</p><pre><code class="language-json hljs">{
    &quot;files.autoSave&quot;: &quot;onFocusChange&quot;,
    &quot;workbench.tree.indent&quot;: 24,
    &quot;editor.insertSpaces&quot;: true,
    &quot;editor.tabSize&quot;: 4,
    &quot;editor.detectIndentation&quot;: false,
    &quot;[julia]&quot;: {
        &quot;editor.defaultFormatter&quot;: &quot;julialang.language-julia&quot;
    },
    &quot;juliaFormatter.margin&quot;: 160,
    &quot;juliaFormatter.alwaysForIn&quot;: true,
    &quot;juliaFormatter.annotateUntypedFieldsWithAny&quot;: false,
    &quot;juliaFormatter.whitespaceInKwargs&quot;: false,
    &quot;juliaFormatter.overwriteFlags&quot;: true,
    &quot;juliaFormatter.alwaysUseReturn&quot;: true,
}</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>To add these settings to VScode add these lines to: <code>&lt;Command&gt; + &lt;shift&gt; + p</code> -&gt; <code>Preferences: Open User Settings (JSON)</code></p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>To format Julia you will need to install <code>Julia Language Support</code> under the extensions tab (<code>&lt;Command&gt; + &lt;shift&gt; + x</code>)</p></div></div><h2 id="Track-Julia-precompilation"><a class="docs-heading-anchor" href="#Track-Julia-precompilation">Track Julia precompilation</a><a id="Track-Julia-precompilation-1"></a><a class="docs-heading-anchor-permalink" href="#Track-Julia-precompilation" title="Permalink"></a></h2><p>To see what is precompiled at runtime, you can add a Julia kernel with the <code>trace-compile</code> option to Jupyter</p><pre><code class="language-julia hljs">import IJulia
IJulia.installkernel(&quot;Julia tracecompile&quot;, &quot;--trace-compile=stderr&quot;)</code></pre><p>Then select the <code>Julia tracecompile</code> in jupyter-lab</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If you want to remove jupyter kernels you don&#39;t use anymore you can list them first with <code>jupyter kernelspec list</code> and remove via <code>jupyter kernelspec remove &lt;your kernel&gt;</code></p></div></div><h2 id="Run-Julia-within-a-Python-environment"><a class="docs-heading-anchor" href="#Run-Julia-within-a-Python-environment">Run Julia within a Python environment</a><a id="Run-Julia-within-a-Python-environment-1"></a><a class="docs-heading-anchor-permalink" href="#Run-Julia-within-a-Python-environment" title="Permalink"></a></h2><p>This can be particularly useful for benchmarking FUSE physics against existing Python routines (eg. in OMFIT)</p><ol><li><p>Install <code>PyCall</code> in your Julia environment:</p><pre><code class="nohighlight hljs">export PYTHON=&quot;&quot; # Sometimes one needs to empty the PYTHON environmental variable to install PyCall
julia -e &#39;using Pkg; Pkg.add(&quot;PyCall&quot;); Pkg.build(&quot;PyCall&quot;)&#39;</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Python and Julia must be compiled for the same architecture. For example, to install Julia x64 in a Apple Silicon MACs:</p><pre><code class="language-bash hljs">juliaup add release~x64
export PYTHON=&quot;&quot;
julia +release~x64 -e &#39;using Pkg; Pkg.add(&quot;PyCall&quot;); Pkg.build(&quot;PyCall&quot;)&#39;</code></pre><p>You can make this verison your default one with</p><pre><code class="language-bash hljs">juliaup default release~x64</code></pre></div></div></li><li><p>Use pip to install the package PyJulia — remember to use the same Python passed to ENV[&quot;PYTHON&quot;]:</p><pre><code class="language-bash hljs">python3 –m pip install julia</code></pre></li><li><p>Configure the communication between Julia and Python by running the following in the Python interpreter:</p><pre><code class="language-python hljs">import julia
julia.install()</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If you have more than one Julia version on our system, we could specify it with an argument:</p><pre><code class="nohighlight hljs">julia.install(julia=&quot;/Users/meneghini/.julia/juliaup/julia-1.8.5+0.x64.apple.darwin14/bin/julia&quot;)</code></pre></div></div></li><li><p>Test the installation running the following in the Python interpreter run:</p><pre><code class="language-python hljs">from julia import Main
Main.eval(&#39;[x^2 for x in 0:4]&#39;)</code></pre></li><li><p>Now, try something more useful:</p><pre><code class="language-python hljs">from julia.api import Julia
Julia(compiled_modules=False)
def S(string): # from Python str to Julia Symbol
    return Main.eval(f&quot;PyCall.pyjlwrap_new({string})&quot;)

from julia import Main, IMAS, FUSE, Logging
FUSE.logging(Logging.Info, actors=Logging.Debug);

ini, act = FUSE.case_parameters(S(&quot;:FPP&quot;), version=S(&quot;:v1_demount&quot;), init_from=S(&quot;:scalars&quot;), STEP=True);
dd = FUSE.init(ini, act);

eqt=dd.equilibrium.time_slice[-1]
cp1d=dd.core_profiles.profiles_1d[-1]
jFUSE = IMAS.Sauter_neo2021_bootstrap(eqt, cp1d, neo_2021=True)</code></pre></li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="deps.html">« Ecosystem</a><a class="docs-footer-nextpage" href="install.html">Install FUSE »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Friday 18 October 2024 02:44">Friday 18 October 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
